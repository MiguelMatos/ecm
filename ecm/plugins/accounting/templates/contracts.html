{% extends "base.html" %}

{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}accounting/css/classes.css" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}hr/css/classes.css" />
{% endblock %}

{% block headtitle %}Contracts{% endblock %}


{% block breadcrumbs %}
<li><a href="/">Home</a></li>
<li><a href="/accounting/">Accounting</a></li>
<li><a href="/accounting/contracts/">Contracts</a></li>
{% endblock %}

{% block main_content %}
<h1>Contracts <small>last update {{ scan_date|ecm_datetime }}</small></h1>

<form id="search_form" class="form-search form-inline">
  <div class="btn-toolbar" >
    <input type="text" id="search_text" class="input-medium search-query" value="" />
    <div class="btn-group">
      <a class="btn btn-small" id="search_button"><i class="icon-search"></i> Search</a>
      <a class="btn btn-small" id="clear_search">Reset</a>
    </div>
  </div>
</form>

<table class="table table-bordered table-condensed" id="contract_table">
  <thead>
    <tr>
      <th class="top" scope="col" >Type</th>
      <th class="top" scope="col" >Status</th>
      <th class="top" scope="col" >Title</th>
      <th class="top" scope="col" >Date Issued</th>
      <th class="top" scope="col" >Date Expired</th>
      <th class="top" scope="col" >Date Accepted</th>
      <th class="top" scope="col" >Date Completed</th>
      <th class="top" scope="col" >Price</th>
      <th class="top" scope="col" >Reward</th>
      <th class="top" scope="col" >Collateral</th>
      <th class="top" scope="col" >Buyout</th>
      <th class="top" scope="col" >Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="12" class="dataTables_empty">Loading data from server...</td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <th>Type</th>
      <th>Status</th>
      <th>Title</th>
      <th>Date Issued</th>
      <th>Date Expired</th>
      <th>Date Accepted</th>
      <th>Date Completed</th>
      <th>Price</th>
      <th>Reward</th>
      <th>Collateral</th>
      <th>Buyout</th>
      <th>Volume</th>
    </tr>
  </tfoot>

</table>
{% endblock %}





{% block compressed_javascripts %}
<script>
$(document).ready(function() {
    var table = $('#contract_table').dataTable($.extend(true, {}, DATATABLE_DEFAULTS, {
        sAjaxSource: "/accounting/contracts/data/",
        aoColumns: [
            { /* Type*/             sWidth: "5%",  sType: "string" },
            { /* Status */          sWidth: "5%",  sType: "string" },
            { /* Title */           sWidth: "5%",  sType: "string",  bSortable: false },
            { /* Date Issued */     sWidth: "5%",  sType: "string",  bSortable: false },
            { /* Date Expired */    sWidth: "5%",  sType: "string",  bSortable: false },
            { /* Date Accepted */   sWidth: "5%",  sType: "string",  bSortable: false },
            { /* Date Completed */  sWidth: "5%",  sType: "string",  bSortable: false },
            { /* Price */           sWidth: "5%",  sType: "string",  bSortable: false,  sClass: "right" },
            { /* Reward*/           sWidth: "5%",  sType: "string",  bSortable: false,  sClass: "right" },
            { /* Collatteral */     sWidth: "5%",  sType: "string",  bSortable: false,  sClass: "right" },
            { /* Buyout */          sWidth: "5%",  sType: "string",  bSortable: false,  sClass: "right" },
            { /* Volume*/           sWidth: "5%",  sType: "numeric", bSortable: false,  sClass: "right" }
        ],
        fnRowCallback: function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
            switch (aData[1]) {
                case "Outstanding": $('td:eq(1)', nRow).addClass('outstanding');
                                 break;
                case "Deleted": $('td:eq(1)', nRow).addClass('deleted');
                                 break;
                case "Completed": $('td:eq(1)', nRow).addClass('completed');
                                 break;
                case "Failed": $('td:eq(1)', nRow).addClass('failed');
                                 break;
                case "CompletedByIssuer": $('td:eq(1)', nRow).addClass('completedbyissuer');
                                 break;
                case "CompletedByContractor": $('td:eq(1)', nRow).addClass('completedbycontractor');
                                 break;
                case "Cancelled": $('td:eq(1)', nRow).addClass('cancelled');
                                 break;
                case "Rejected": $('td:eq(1)', nRow).addClass('rejected');
                                 break;
                case "Reversed": $('td:eq(1)', nRow).addClass('reversed');
                                 break;
                case "InProgress": $('td:eq(1)', nRow).addClass('inprogress');
                                 break;
            }
            return nRow;
        },


        /* this function will be called when the table has to query data to be displayed */
        fnServerData: function ( sSource, aoData, fnCallback ) {
            /* Add some extra variables to the url 
            aoData.push( {
                name: "walletID",
                value: $("#wallet_selector option:selected").val()
            },{
                name: "entryTypeID",
                value: $("#type_selector option:selected").val()
            } ); */

            $.getJSON( sSource, aoData, function (json) {
                fnCallback(json)
            } );
        },
    }));

  /* trigger the search when pressing return in the text field */
    $("#search_form").submit(function(event) {
        event.preventDefault();
        table.fnFilter($("#search_text").val());
    });

    /* trigger the search when clicking the "search" button */
    $("#search_button").click(function() {
        table.fnFilter($("#search_text").val());
    });

    /* reset the search when clicking the "reset" button */
    $("#clear_search").click(function() {
        $("#search_text").val("");
        table.fnFilter("");
    });

    /* disable multi column sorting */
    $('#contract_table thead th').click(function(event) {
        if (!$(event.target).hasClass('sorthandle')) {
            event.shiftKey = false;
        }
    });

} );
</script>
{% endblock %}


