{% extends "base.html" %}

{% block headtitle %}POS Details - {{ pos }}{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}pos/css/classes.css" />
{% endblock %}

{% block breadcrumbs %}
<li><a href="/">Home</a></li>
<li><a href="/pos">POS</a></li>
<li class="active"><a href="/pos/{{ pos.item_id }}/">{{ pos.moon }}</a></li>
{% endblock %}

{% block main_content %}
<div class="page-header{%if pos.state != 4%} error{%endif%}">
  <h1>{{ pos.moon }}{%if pos.state != 4%} - {{pos.state_text}}{% endif %} <small id="custom_name" class="editable">{{ pos.custom_name|default_if_none:"" }}</small>
  </h1>
</div>

<div class="row-fluid">
  <div class="span2">
    <img src="http://image.eveonline.com/Render/{{pos.type_id}}_128.png" title="{{pos.type_name}}"/>
  </div>
  <div class="span4">
    <h3>General Info</h3>
    <dl class="table">
      <dt{%if pos.state == 3%} class="error"{%endif%}>State</dt>
        <dd>{{pos.state_text}}{%if pos.state == 3%} until {{pos.state_timestamp|ecm_datetime}}{%endif%}</dd>
      <dt>Online since</dt>
        <dd>{{pos.online_timestamp|ecm_datetime}}</dd>
      <dt>POS type</dt>
        <dd>{{pos.type_name}}</dd>
    </dl>
  </div>
  <div class="span6">
    <h3><span class="dotlan">dotlan &copy;</span> Links</h3>
    <ul>
      <li><a href="http://evemaps.dotlan.net/system/{{pos.location}}" target="_blank">{{pos.location}}</a></li>
      <li><a href="http://evemaps.dotlan.net/system/{{pos.location}}/{{dotlanPOSLocation}}" target="_blank">{{pos.moon}}</a></li>
    </ul>
  </div>
</div>

<div class="row-fluid">
  <div class="span5">
      <h3>Access Control</h3>
      <dl class="table">
        <dt>Allow corp members in force field</dt>
          <dd>{{pos.allow_corporation_members}}</dd>
        <dt>Allow ally members in force field</dt>
          <dd>{{pos.allow_alliance_members}}</dd>
        <dt>Can view fuel bay</dt>
          <dd>{{pos.fuel_bay_view_access|safe}}</dd>
        <dt>Can take in fuel bay</dt>
          <dd>{{pos.fuel_bay_take_access|safe}}</dd>
        <dt>Can anchor modules</dt>
          <dd>{{pos.anchor_access|safe}}</dd>
        <dt>Can unanchor modules</dt>
          <dd>{{pos.unanchor_access|safe}}</dd>
        <dt>Can online modules</dt>
          <dd>{{pos.online_access|safe}}</dd>
        <dt>Can offline modules</dt>
          <dd>{{pos.offline_access|safe}}</dd>
      </dl>
  </div>
  <div class="span4">
      <h3>Combat Settings</h3>
      <dl class="table">
        {%if pos.standings_threshold != 0.0%}
        <dt>Attack when standing is bellow</dt>
          <dd>{{pos.standings_threshold}} (use standings from {{use_standings_from}})</dd>
        {%else%}
        <dt>Attack on bad standing</dt>
          <dd>False</dd>
        {%endif%}
        {%if pos.security_status_threshold != 0.0%}
        <dt>Attack when security status is bellow</dt>
          <dd>{{pos.security_status_threshold}}</dd>
        {%else%}
        <dt>Attack when security status is bad</dt>
          <dd>False</dd>
        {%endif%}
        <dt>Attack on concord flag</dt>
          <dd>{{pos.attack_on_concord_flag}}</dd>
        <dt>Attack on aggression</dt>
          <dd>{{pos.attack_on_aggression}}</dd>
        <dt>Attack war targets</dt>
          <dd>{{pos.attack_on_corp_war}}</dd>
      </dl>
  </div>
</div>

<h2>Fuel Levels</h2>

<table class="table table-bordered" id="fuel_table">
  <thead>
    <tr>
      {% for col in columns %}
      <th class="top" scope="col" >{{col}}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="{{columns|length}}" class="dataTables_empty">Loading data from server...</td>
    </tr>
  </tbody>
</table>
{% endblock %}

{% block compressed_javascripts %}
<script>
/*************************
 * "POS" table setup *
 *************************/
/*POS_CSS_STATUS = {{posCSSStatus|safe}};
POS_TEXT_STATUS = {{posTextStatus|safe}};*/
DISPLAY_MODE = 'quantities'; /* default */
$(document).ready(function() {
    var table = $('#fuel_table').dataTable($.extend(true, {}, DATATABLE_DEFAULTS, {
        iDisplayLength: 10, 		/* default display 25 items */
        sAjaxSource: "/pos/{{ pos.item_id }}/data/",
        aoColumns: [
            { /* 0 Icon */      sWidth: "10%", sClass: "center", bSortable: false },
            { /* 1 Name */      sWidth: "30%", bSortable: false  },
            { /* 2 Quantity */  sWidth: "15%", bSortable: false  },
            { /* 3 Cons/Hour */ sWidth: "15%", bSortable: false },
            { /* 4 Cons/day */  sWidth: "15%", bSortable: false },
            { /* 5 TimeLeft */  sWidth: "15%", bSortable: false },
        ],
        fnRowCallback: function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
            fuelTypeID = aData[0];
            fuelTypeName = aData[1];
            fuelImgUrl = 'http://image.eveonline.com/Type/' + fuelTypeID + '_32.png';
            $('td:eq(0)', nRow).html('<img src="' + fuelImgUrl + '" title="' + fuelTypeName + '"/>');
            for (i=2; i<6; i++) {
                $('td:eq(' + i + ')', nRow).addClass('right');
                if (aData[i] == '0' || aData[i] == '0h') {
                    $('td:eq(' + i + ')', nRow).addClass('fuel-warning');
                }
            }
            return nRow;
        },

    }));

    /* disable multi column sorting */
    $('#pos_table thead th').click(function(event) {
        if (!$(event.target).hasClass('sorthandle')) {
            event.shiftKey = false;
        }
    });

    /* Apply a jEditable handler to the "Name" section */
    $('#custom_name').editable( '/pos/{{ pos.item_id }}/updatename/', {
        placeholder: 'Click to Change Name...',
        style: 'inherit',
        cssClass: 'edited',
        callback: function( sValue, y ) {
            $('#custom_name').html(sValue);
        },
        tooltip   : 'Click to edit...'
    });
});

</script>
{% endblock %}

