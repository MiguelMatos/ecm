{% extends "base.html" %}

{% block headtitle %}POS Details - {{ pos }}{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}pos/css/classes.css" />
{% endblock %}

{% block breadcrumbs %}
<li><a href="/">Home</a></li>
<li><a href="/pos">POS</a></li>
<li><a href="/pos/{{ pos.item_id }}/">{{ pos.moon }}</a></li>
{% endblock %}

{% block main_content %}
<h1 class="pagetitle{%if pos.state != 4%} error{%endif%}">{{ pos.moon }}{%if pos.state != 4%} - {{pos.stateText}}{% endif %}</h1>

<table class="transparent">
  <tr>
    <td>
      <img src="http://image.eveonline.com/Render/{{pos.type_id}}_128.png" title="{{pos.type_name}}"/>
    </td>
    <td>
      <table>
        <tr>
          <td>
            <h2>Name</h2>
            <h3><div id="custom_name" class="editable" >{{ pos.custom_name|default_if_none:"" }}</div></h3>
          </td>
        </tr>
      <tr>
        <td>
          <h2>General Info</h2>
          <ul>
            <li{%if pos.state == 3%} class="error"{%endif%}><b>State:</b> {{pos.stateText}}{%if pos.state == 3%} until {{pos.state_timestamp|ecm_datetime}}{%endif%}</li>
            <li><b>Online since:</b> {{pos.online_timestamp|ecm_datetime}}</li>
            <li><b>POS type:</b> {{pos.type_name}}</li>
          </ul>
        </td>
        <td>
          <h2><span class="dotlan">dotlan &copy;</span> Links</h2>
          <ul>
            <li><a href="http://evemaps.dotlan.net/system/{{pos.location}}" target="_blank">{{pos.location}}</a></li>
            <li><a href="http://evemaps.dotlan.net/system/{{pos.location}}/{{dotlanPOSLocation}}" target="_blank">{{pos.moon}}</a></li>
          </ul>
        </td>
      </tr>
      </table>
    </td>
  </tr>
</table>

<table class="transparent">
  <tr>
    <td>
      <h2>Access Control</h2>
      <ul>
        <li><b>Allow corp members in force field:</b> {{pos.allow_corporation_members}}</li>
        <li><b>Allow ally members in force field:</b> {{pos.allow_alliance_members}}</li>
        <li><b>Can view fuel bay:</b> {{pos.fuel_bay_view_access|safe}}</li>
        <li><b>Can take in fuel bay:</b> {{pos.fuel_bay_take_access|safe}}</li>
        <li><b>Can anchor modules:</b> {{pos.anchor_access|safe}}</li>
        <li><b>Can unanchor modules:</b> {{pos.unanchor_access|safe}}</li>
        <li><b>Can online modules:</b> {{pos.online_access|safe}}</li>
        <li><b>Can offline modules:</b> {{pos.offline_access|safe}}</li>
      </ul>
    </td>
    <td>
      <h2>Combat Settings</h2>
      <ul>
        {%if pos.standings_threshold != 0.0%}
        <li><b>Attack when standing is bellow:</b> {{pos.standings_threshold}} (use standings from {{use_standings_from}})</li>
        {%else%}
        <li><b>Attack on bad standing:</b> False</li>
        {%endif%}
        {%if pos.security_status_threshold != 0.0%}
        <li><b>Attack when security status is bellow:</b> {{pos.security_status_threshold}}</li>
        {%else%}
        <li><b>Attack when security status is bad:</b> False</li>
        {%endif%}
        <li><b>Attack on concord flag:</b> {{pos.attack_on_concord_flag}}</li>
        <li><b>Attack on aggression:</b> {{pos.attack_on_aggression}}</li>
        <li><b>Attack war targets:</b> {{pos.attack_on_corp_war}}</li>
      </ul>
    </td>
  </tr>
</table>



<h2>Fuel Levels</h2>

<table class="table display" id="fuel_table">
  <thead>
    <tr>
      {% for col in columns %}
      <th class="top" scope="col" >{{col}}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="{{columns|length}}" class="dataTables_empty">Loading data from server...</td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      {% for col in columns %}
      <th>{{col}}</th>
      {% endfor %}
    </tr>
  </tfoot>
</table>
{% endblock %}

{% block compressed_javascripts %}
<script>
/*************************
 * "POS" table setup *
 *************************/
AJAX_URL = "/pos/{{ pos.item_id }}/data/";
/*POS_CSS_STATUS = {{posCSSStatus|safe}};
POS_TEXT_STATUS = {{posTextStatus|safe}};*/
DISPLAY_MODE = 'quantities'; /* default */
$(document).ready(function() {
    var table = $('#fuel_table').dataTable( {
        "sPaginationType": "full_numbers",
        "bProcessing": true,
        "bServerSide": true,
        "bAutoWidth": false,
        "iDisplayLength": 10, 		/* default display 25 items */
        "bStateSave": true, 		/* table state persistance */
        "iCookieDuration": 60 * 60, /* persistance duration 1 hour */
        "sAjaxSource": AJAX_URL,
        "sDom": 'lprtip', 			/* table layout. see http://www.datatables.net/usage/options */
        "aoColumns": [
            { /* 0 Icon */      "sWidth": "10%", "sClass": "center", "bSortable": false },
            { /* 1 Name */      "sWidth": "30%", "bSortable": false  },
            { /* 2 Quantity */  "sWidth": "15%", "bSortable": false  },
            { /* 3 Cons/Hour */ "sWidth": "15%", "bSortable": false },
            { /* 4 Cons/day */  "sWidth": "15%", "bSortable": false },
            { /* 5 TimeLeft */  "sWidth": "15%", "bSortable": false },
        ],
        "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
            fuelTypeID = aData[0];
            fuelTypeName = aData[1];
            fuelImgUrl = 'http://image.eveonline.com/Type/' + fuelTypeID + '_32.png';
            $('td:eq(0)', nRow).html('<img src="' + fuelImgUrl + '" title="' + fuelTypeName + '"/>');
            for (i=2; i<6; i++) {
                $('td:eq(' + i + ')', nRow).addClass('right');
                if (aData[i] == '0' || aData[i] == '0h') {
                    $('td:eq(' + i + ')', nRow).addClass('fuel-warning');
                }
            }
            return nRow;
        },

    });

    /* disable multi column sorting */
    $('#pos_table thead th').click(function(event) {
        if (!$(event.target).hasClass('sorthandle')) {
            event.shiftKey = false;
        }
    });

});
/* Apply a jEditable handler to the "Name" section */
$('#custom_name').editable( '/pos/{{ pos.item_id }}/updatename/', {
    placeholder: 'Click to Change Name...',
    style: 'inherit',
    cssClass: 'edited',
    callback: function( sValue, y ) {
        $('#custom_name').html(sValue);
    },
    tooltip   : 'Click to edit...'
});

</script>
{% endblock %}

