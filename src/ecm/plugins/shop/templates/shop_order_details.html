{% extends "base.html" %}

{% block headtitle %}Order #{{ order.id }} Details{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="/s/ecm/css/jquery.dataTables.css" />
{% endblock %}

{% block breadcrumbs %}
<li><a href="/">Home</a></li>
<li><a href="/shop/">Shop</a></li>
<li><a href="/shop/orders/">My Orders</a></li>
<li><a href="/shop/orders/{{ order.id }}/">#{{ order.id }}</a></li>
{% endblock %}

{% block main_content %}
<h1 class="pagetitle">Order #{{ order.id }} <span class="date">- {{order.stateText}}</span></h1>

<table class="transparent">
  <tbody>
    <tr>
      <td class="bold">Manufactured by</td>
      <td class="right">{{order.manufacturer_permalink|safe}}</td>
    </tr>
    <tr>
      <td class="bold">Delivered by</td>
      <td class="right">{{order.deliveryMan_permalink|safe}}</td>
    </tr>
    <tr>
      <td class="bold">Creation Date</td>
      <td class="right">{{order.creationDate|ecm_datetime}}</td>
    </tr>
    <tr>
      <td class="bold">Last Modified</td>
      <td class="right">{{order.lastModified|ecm_datetime}}</td>
    </tr>
    <tr>
      <td class="bold">Delivery Date</td>
      <td class="right">{{order.deliveryDate|ecm_datetime}}</td>
    </tr>
  </tbody>
</table>

<ul>
  {% for transition, name in validTransitions %}
  <li><a class="button" id="{{transition}}" href="/shop/orders/{{order.id}}/{{transition}}/">{{name}}</a></li>
  {% endfor %}
</ul>

<form id="cancel_form" method="post" action="/shop/orders/{{order.id}}/cancel/" style="display: none;">
{%csrf_token%}
    <input name="comment" id="comment" value=""/>
</form>

<script type="text/javascript">
$('#cancel').click(function(event) {
    event.preventDefault();
    var comment = prompt('Please leave a comment on why to cancel this order:');
    $('#comment').val(comment);
    $('#cancel_form').submit();
});
{% if error %}
$(document).ready(function () {
    alert('{{error|safe}}');
});
{% endif %}
</script>

<h1>Items</h1>

<table class="order_table">
    <thead>
      <tr>
      <th style="width: 10%;">Icon</th>
      <th style="width: 30%;">Item</th>
      <th style="width: 20%;">Quantity</th>
      <th style="width: 40%;">Price</th>
      </tr>
    </thead>
  <tbody>
    {% for row in order.rows.all %}
    <tr>
          <td class="center"><img src="http://image.eveonline.com/Type/{{row.catalogEntry.typeID}}_32.png" /></td>
           <td class="bold">{{row.catalogEntry.typeName}}</td>
           <td class="center">{{row.quantity|ecm_quantity}}</td>
           <td class="right">{%if row.quote == 0.0%}N/A{%else%}{{row.quote|ecm_price}} ISK{%endif%}</td>
         </tr>
         {% empty %}
         <tr id="empty">
           <td colspan="4" class="order_cart_empty" >No items in order.</td>
         </tr>
         {% endfor %}
    <tr>
      <td colspan="3" class="bold right" >Quote</td>
      <td class="bold right" >{%if order.quote == 0.0%}N/A{%else%}{{order.quote|ecm_price}} ISK{%endif%}</td>
    </tr>
  </tbody>
</table>

<ul>
{% for log in logs %}
  <li>{{log.date|ecm_datetime}} [{{log.state_text}}] <b>{{log.user}}</b> - {{log.text}}</li>
{% endfor %}
</ul>

{% endblock %}
