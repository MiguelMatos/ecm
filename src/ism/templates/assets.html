{% extends "base.html" %}

{% block headtitle %}Stations{% endblock %}



{% block header_scripts %}
<link rel="stylesheet" type="text/css" media="screen,projection,print" href="/static/css/tablesorter.css" />
<script type="text/javascript" src="/static/js/jquery.js"></script>
<script type="text/javascript" src="/static/js/jquery.jstree.js"></script>
<script type="text/javascript">
function filter (phrase, _id){
    var words = phrase.value.toLowerCase().split(" ");
    var table = document.getElementById(_id);
    var ele;
    for (var r = 1; r < table.rows.length; r++){
        ele = table.rows[r].innerHTML.replace(/<[^>]+>/g,"");
        var displayStyle = 'none';
        for (var i = 0; i < words.length; i++) {
            if (ele.toLowerCase().indexOf(words[i])>=0) {
                displayStyle = '';
            } else {
                displayStyle = 'none';
                break;
            }
        }
        table.rows[r].style.display = displayStyle;
    }
}
</script>
{% endblock %}


{% block breadcrumbs %}
<li><a href="/assets/" >Assets</a></li>
<li><a href="/assets/" >Stations</a></li>
{% endblock %}

{% block main_content %}
<p class="center">{{ item_count }} items found on {{ scan_date }}</p>


<form class="filter">
    <input 
        type="text" 
        name="filt" 
        title="Type any string to filter out the lines in the table. The filter is not case sensitive and searches through all the columns." 
        id="filterstring" 
        value="Filter" 
        onkeyup="filter(this, 'stations_table', '1')" 
        onclick="document.getElementById('filterstring').select()" />
</form>

<div id="assets_tree"></div>

<script type="text/javascript">

$(function () {
    $("#assets_tree").jstree({ 
        "plugins" : [ "themes" , "json_data" , "ui",  "types" , "sort"],
        "core" : { 
            "animation" : 150,
            "html_titles" : true,
            
        },
        "ui" : {
            "select_limit" : 1
        },
        "themes" : {
            "theme" : "default",
            "dots" : false
        },
        "types" : {
            "max_depth" : -2,
            "max_children" : -2,
            "valid_children" : [ "station" ],
            "types" : {
                "station" : {
                    "class" : "station-row",
                    "icon" : { 
                        "image" : "/static/img/station.png" 
                    },
                    "valid_children" : [ "hangar" ],
                    "max_depth" : 4,
                    "open_node"   : true,
                    "close_node"  : true
                },
                "hangar" : {
                    "icon" : { 
                        "image" : "/static/img/hangar.png" 
                    },
                    "valid_children" : [ "can", "mineral", "ship",  "ammo", "blueprint","item" ],
                    "max_depth" : 3,
                    "open_node"   : true,
                    "close_node"  : true
                },
                "ship" : {
                    "icon" : { 
                        "image" : "/static/img/ship.png" 
                    },
                    "valid_children" : [ "can", "mineral", "ship",  "ammo", "blueprint","item" ],
                    "max_depth" : 2,
                    "open_node"   : true,
                    "close_node"  : true
                },
                "can" : {
                    "icon" : { 
                        "image" : "/static/img/can.png" 
                    },
                    "valid_children" : [ "can", "mineral", "ship",  "ammo", "blueprint","item" ],
                    "max_depth" : 1,
                    "open_node"   : true,
                    "close_node"  : true
                },
                "item" : {
                    "icon" : { 
                        "image" : "/static/img/item.png" 
                    },
                    "valid_children" : "none",
                    "max_depth" : 0,
                    "select_node" : true,
                    "open_node"   : true,
                    "close_node"  : true,
                    "create_node" : false,
                    "delete_node" : false
                },
                "mineral" : {
                    "icon" : { 
                        "image" : "/static/img/mineral.png" 
                    },
                    "valid_children" : "none",
                    "max_depth" : 0,
                    "select_node" : true,
                    "open_node"   : true,
                    "close_node"  : true,
                    "create_node" : false,
                    "delete_node" : false
                },
                "blueprint" : {
                    "icon" : { 
                        "image" : "/static/img/blueprint.png" 
                    },
                    "valid_children" : "none",
                    "max_depth" : 0,
                    "select_node" : true,
                    "open_node"   : true,
                    "close_node"  : true,
                    "create_node" : false,
                    "delete_node" : false
                },
                "ammo" : {
                    "icon" : { 
                        "image" : "/static/img/ammo.png" 
                    },
                    "valid_children" : "none",
                    "max_depth" : 0,
                    "select_node" : true,
                    "open_node"   : true,
                    "close_node"  : true,
                    "create_node" : false,
                    "delete_node" : false
                }
            }
        },
        "json_data" : {
            "data" : [
                {% for s in station_list %}
                {
                    "data" : '<b>{{ s.name }}</b><i> - ({{ s.items }} items)</i>',
                    "attr" : { "id" : "node_{{ s.locationID }}/" , "rel" : "station" , "class" : "station-row" },
                    "state" : "closed"
                },
                {% endfor %}
            ],
            "ajax" : {
                "url" : function(node) { 
                    var url = "/assets/";
                    url += node.attr ? node.attr("id").replace("node_", "") : "";
                    return url; 
                }
            }
        }
    });
});

</script>

{% endblock %}
